# 📄 PRD 문서 – 식약처 인허가 업소 정보 자동 수집 시스템

## 1. 개요

**목표**: 식품의약품안전처 공공데이터포털(OpenAPI, I2500)을 통해 인허가 업소 정보를 매일 자동으로 구글 스프레드시트에 수집

**사용자**: 조병재

**최초 발급일**: 2025-08-16

**상태**: 승인

### 주요 활용

- 업소명/대표자명/주소/전화번호 기반 데이터 정리
- 매일 오전 8시 자동 업데이트
- 스프레드시트 기반 검색/필터링 및 가공

## 2. 요구사항

### API 정보

- **서비스명**: 인허가 업소 정보 (I2500)
- **제공기관**: 식품의약품안전처
- **API 호출 제한**: 1,000회/일
- **업데이트 주기**: 상시
- **데이터 포맷**: JSON

#### API 엔드포인트

```
http://openapi.foodsafetykorea.go.kr/api/{인증키}/I2500/json/{startIdx}/{endIdx}
```

#### 요청 파라미터

| 파라미터 | 타입 | 필수 | 설명 |
|---------|------|------|------|
| keyId | STRING | ✓ | API 인증키 |
| serviceId | STRING | ✓ | 서비스명 (I2500) |
| dataType | STRING | ✓ | 요청 파일 타입 (json) |
| startIdx | NUMBER | ✓ | 요청 시작 위치 (정수) |
| endIdx | NUMBER | ✓ | 요청 종료 위치 (정수) |
| LCNS_NO | STRING | - | 영업고유구분번호 (필터) |
| INDUTY_CD_NM | STRING | - | 업종 (필터) |
| BSSH_NM | STRING | - | 업소명 (필터) |
| CHNG_DT | STRING | - | 최종수정일자 (YYYYMMDD) |

### 데이터 수집

- API 인증키를 환경변수(Apps Script Script Properties)에 안전하게 보관
  - Key: `FOOD_SAFETY_API_KEY`
- 매일 오전 8시 트리거 실행
- JSON 포맷으로 API 호출
- 한 번에 1000건씩 페이징 처리

### 데이터 구조

- **1행**: 메타 정보 (최종 실행 일시)
- **2행**: 컬럼 헤더 (고정)
- **3행~**: 데이터
- **1열**: no (자동 증가 번호)
- **2열~8열**: API 반환 필드
  - `LCNS_NO` (영업고유구분번호/인허가번호)
  - `INDUTY_CD_NM` (업종)
  - `BSSH_NM` (업소명)
  - `PRSDNT_NM` (대표자명)
  - `TELNO` (전화번호)
  - `PRMS_DT` (허가일자)
  - `ADDR` (주소)

### 운영 관리

- 초기 `setup()` 실행 시 헤더/메뉴/트리거 자동 설치
- 메뉴 버튼 제공:
  - "지금 가져오기"
  - "8시 트리거 재설치"

## 3. 비기능 요구사항

- **보안**: 인증키는 코드에 직접 저장하지 않고 Script Properties에 저장
- **확장성**: 향후 필터(CHNG_DT, INDUTY_CD_NM)를 통한 증분 업데이트 지원
- **제한사항**: API 호출 제한 1,000회/일 → FETCH_SIZE 조정 필요

## 4. 성공 기준

- 매일 오전 8시 자동 실행 성공
- 시트에 정상적으로 신규 데이터가 추가
- 헤더 및 메타 정보(최종 실행 일시)가 정확히 갱신
