# 📘 설치 가이드 – 식약처 인허가 업소 정보 자동 수집 시스템

## 📋 사전 준비사항

### 1. API 인증키 발급

1. [공공데이터포털](https://www.data.go.kr/) 접속
2. 회원가입 및 로그인
3. **인허가 업소 정보(I2500)** 검색
4. **활용신청** → 승인 대기 (보통 1~2시간 소요)
5. **마이페이지 → 인증키 발급현황**에서 인증키 복사

### 2. 구글 스프레드시트 생성

1. [Google Sheets](https://sheets.google.com/) 접속
2. 새 스프레드시트 생성
3. 시트명을 **"I2500_업소"**로 변경
4. URL에서 스프레드시트 ID 복사
   ```
   https://docs.google.com/spreadsheets/d/[이_부분이_ID]/edit
   예: 1A2B3C4D5E6F7G8H9I0J
   ```

## 🚀 설치 단계

### Step 1: Apps Script 프로젝트 생성

1. 스프레드시트에서 **Extensions → Apps Script** 클릭
2. 기본 코드 전체 삭제
3. `Code.gs` 파일 내용 전체 복사하여 붙여넣기

### Step 2: 스프레드시트 ID 설정

**Code.gs 파일 상단 수정:**

```javascript
// 🔧 설정 영역 - 반드시 수정하세요!
const SPREADSHEET_ID = "여기에_스프레드시트_ID_입력";
```

**예시:**
```javascript
const SPREADSHEET_ID = "1A2B3C4D5E6F7G8H9I0J";
```

### Step 3: API 키 환경변수 등록

1. Apps Script 편집기 좌측 **⚙️ 프로젝트 설정** 클릭
2. **Script Properties** 섹션으로 이동
3. **속성 추가** 버튼 클릭
4. 다음과 같이 입력:
   - **속성**: `FOOD_SAFETY_API_KEY`
   - **값**: 발급받은 API 인증키
5. **속성 저장** 클릭

### Step 4: 초기 설정 실행

1. Apps Script 편집기 상단에서 함수 선택 드롭다운 클릭
2. **setup** 함수 선택
3. **실행(▶)** 버튼 클릭
4. 권한 승인 팝업이 뜨면:
   - **권한 검토** 클릭
   - 구글 계정 선택
   - **고급** → **프로젝트 이름(안전하지 않음)으로 이동** 클릭
   - **허용** 클릭
5. "✅ 초기 설정이 완료되었습니다!" 메시지 확인

### Step 5: 테스트 실행

1. 스프레드시트로 돌아가기
2. 상단 메뉴에 **"I2500 수집"** 메뉴가 생성된 것 확인
3. **I2500 수집 → 지금 가져오기** 클릭
4. 데이터 수집 완료 메시지 확인
5. 시트에 데이터가 정상적으로 추가되었는지 확인:
   - 1행: 최종 실행 시각
   - 2행: 컬럼 헤더
   - 3행~: 업소 데이터

## ✅ 설치 확인 체크리스트

- [ ] API 인증키 발급 완료
- [ ] 스프레드시트 생성 및 ID 확보
- [ ] Apps Script 코드 붙여넣기
- [ ] `SPREADSHEET_ID` 변수에 ID 입력
- [ ] Script Properties에 `FOOD_SAFETY_API_KEY` 등록
- [ ] `setup()` 함수 실행 및 권한 승인
- [ ] 헤더 행 생성 확인
- [ ] 커스텀 메뉴 ("I2500 수집") 생성 확인
- [ ] "지금 가져오기" 실행 및 데이터 수집 확인
- [ ] 1행에 "최종 실행" 메타 정보 표시 확인

## ⏰ 자동 실행 확인

- 매일 오전 8시에 자동으로 데이터가 수집됩니다.
- 트리거 확인 방법:
  1. Apps Script 편집기 좌측 **⏰ 트리거** 클릭
  2. `fetchDataDaily` 함수가 매일 오전 8시에 실행되도록 설정된 것 확인
- 트리거 재설치: **I2500 수집 → 8시 트리거 재설치**

## 🔧 선택적 설정

### 필터 조건 추가 (선택사항)

특정 조건의 데이터만 가져오려면 `Code.gs` 파일 상단의 `FILTERS` 객체를 수정하세요:

```javascript
const FILTERS = {
  INDUTY_CD_NM: "도축업",      // 특정 업종만 수집
  CHNG_DT: "20250101"          // 2025년 1월 1일 이후 변경된 데이터만
};
```

### 데이터 수집 크기 조정

API 호출 제한(1,000회/일)에 맞춰 한 번에 가져올 데이터 개수를 조정할 수 있습니다:

```javascript
const FETCH_SIZE = 1000; // 기본값: 1000 (최대 1000)
```

## 🐛 문제 해결

### "API 키가 설정되지 않았습니다" 오류

- Script Properties에 `FOOD_SAFETY_API_KEY`가 정확히 입력되었는지 확인
- 속성 이름의 대소문자가 정확한지 확인

### "시트를 찾을 수 없습니다" 오류

- 시트명이 정확히 **"I2500_업소"**인지 확인
- `SPREADSHEET_ID`가 올바르게 입력되었는지 확인

### 데이터가 수집되지 않음

- API 인증키가 승인되었는지 공공데이터포털에서 확인
- Apps Script 실행 로그 확인:
  1. Apps Script 편집기 좌측 **실행** 클릭
  2. 오류 메시지 확인

### "API 호출 제한 초과" 오류

- 일일 API 호출 제한(1,000회)을 초과한 경우
- 다음날 다시 시도하거나 `FETCH_SIZE`를 줄여서 데이터를 분할 수집

## 📞 지원

문제가 지속되면 다음 정보를 포함하여 문의하세요:
- 오류 메시지
- Apps Script 실행 로그
- API 응답 내용 (로그에서 확인 가능)
